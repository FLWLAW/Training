@page "/TrainingQuestionnaireAdministrator"
@using Training.Website.Models
@using Training.Website.Services

<table width="100%">
    <tr>
        <td style="width: 100%; text-align: center; padding-bottom: 30px;">
            <label style="padding-right: 30px;">Session ID:</label>
            <TelerikDropDownList
                Data="@_sessions"
                Value="_selectedSessionString"
                ValueChanged="@(async (string newValue) => await SessionChanged(newValue) )"
                Enabled="true"
                Width="350px">
                <DropDownListSettings>
                    <DropDownListPopupSettings Height="180px" />
                </DropDownListSettings>
            </TelerikDropDownList>
        </td>
    </tr>
</table>
@if(_selectedSessionString != null)
{
    <!-- BOTTOM PORTION OF PAGE -->
    <table style="width: 100%;">
        <tr>
            <td colspan="2" style="width: 100%; text-align: center;">
                <h4><b><u>@_selectedSession?.DocTitle</u></b></h4>
                <br />
            </td>
        </tr>
        @if (_questions != null)
        {
            @foreach(QuestionsModel? question in _questions)
            {
                string? answerFormat = _answerFormats?[question.AnswerFormat!.Value];
                IEnumerable<AnswerChoicesModel>? answerChoices = CommonServiceMethods.GetAnswerChoicesByQuestionID(question.Question_ID!.Value, Database);

                <tr>
                    <td style="width: 20%; text-align: right;">
                        @question.QuestionNumber<label>.</label>
                    </td>
                    <td style="width: 80%; text-align: left; padding-left: 20px;">
                        @question.Question
                    </td>
                </tr>

                @if (AnswerFormatMatch(answerFormat, _multipleChoice) == true)
                {
                    @foreach(AnswerChoicesModel answerChoice in answerChoices!)
                    {
                        <tr>
                            <td colspan="2">
                                <table style="width: 100%">
                                    <tr>
                                        <td style="width: 25%; text-align: right;">
                                            @answerChoice.AnswerLetter
                                        </td>
                                        <td style="width: 75%; text-align: left; padding-left: 30px;">
                                            @answerChoice.AnswerText
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td>&nbsp;</td>
                        <td style="text-align: left; padding-left: 30px;">
                            @if (AnswerFormatMatch(answerFormat, _trueFalse) == true)
                            {
                                <label>True or False?</label>
                            }
                            else if (AnswerFormatMatch(answerFormat, _yesNo) == true)
                            {
                                <label>Yes or No?</label>
                            }
                            else
                            {
                                throw new Exception("Invalid answer format.");
                            }
                        </td>
                    </tr>
                }
                <tr>
                    <td>&nbsp;</td>
                    <td>
                        <table>
                            <tr>
                                <td style="padding-top: 15px;">Answer</td>
                                <td style="padding-top: 15px; padding-left: 15px;">
                                    @if (question.CorrectAnswer?.Length == 1)
                                    {
                                        @question.CorrectAnswer?.ToLower()
                                    }
                                    else
                                    {
                                        @question.CorrectAnswer
                                    }
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2"><br /><br /></td>
                            </tr>
                        </table>
                    </td>
                </tr>
            }
        }
    </table>
}
