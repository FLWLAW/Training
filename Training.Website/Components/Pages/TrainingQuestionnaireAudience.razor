@using Training.Website.Models.Users

@page "/TrainingQuestionnaireAudience"

@if(ApplicationState == null)
{
    <p><strong>Error: ApplicationState is null...</strong></p>
}
else
{
    <TelerikWindow
        Modal="true"
        Visible="@_emailsSentWindowVisible"
        CloseOnOverlayClick="false"
        Width="800px"
        Height="200px">
        <WindowContent>
            <table style="width: 100%; height: 100%; background-color: black; border-color: black;">
                <tr>
                    <td style="width: 100%; text-align: center; font-size: large; color: white; font-weight: 700;" background-color: black;>
                        EMAIL(S) SENT
                    </td>
                </tr>
                <tr>
                    <td style="text-align: center;">
                        <TelerikButton Class="Close" OnClick="@(() => EmailsSentCloseClicked())">Close</TelerikButton>
                    </td>
                </tr>
            </table>
        </WindowContent>
    </TelerikWindow>

    <table width="100%" style="background-color: lightgray;">
        <tr>
            <td colspan="4" class="HeaderClass" style="text-align: center; align-items: center; font-size: small; color: blue;">
                To assign a Questionnaire, it must be emailed to them.<br />
                To email: click the ‘selected’ column next to the User Name that needs to take the Questionnaire.<br />
                Click the button on the right: Send Emails To Selected.<br />
            </td>
        </tr>
        <tr>
            <td colspan="4" class="HeaderClass" style="text-align: center; align-items: center;">
                <span class="HeaderClass" style="padding-right: 15px;">Session ID#:</span>  <!-- THIS PARTICULAR HEADER MOVED TO SAME LINE AS DROP DOWN CONTROL AS REQUESTED BY SUSAN, 2025-12-31 -->
                <TelerikDropDownList Data="@_sessions"
                                     Value="_selectedSessionString"
                                     ValueChanged="@(async (string newValue) => await SessionChanged(newValue))"
                                     Enabled="true"
                                     Width="900px">
                    <DropDownListSettings>
                        <DropDownListPopupSettings Height="180px" />
                    </DropDownListSettings>
                </TelerikDropDownList>
                <TelerikButton Class="UniformButton"
                               OnClick="@(() => ClearSelectedSession() )"
                               Enabled="true">
                    Clear Selection
                </TelerikButton>
            </td>
        </tr>
        <!--
        <tr>
            <td class="HeaderClass HeaderClassCentered">
                <span class="@_spanHeaderClass">Roles:</span>
                <br />
                <TelerikMultiSelect
                    Class="UniformWidth_DropDown"
                    AutoClose="false"
                    Enabled="@SessionSelected()"
                    Data="@_roles?.Select(q => q?.Value).Order()"
                    Value="@_selectedRoles"
                    ValueChanged="@((List<string> newValues) => RolesMultiSelectChanged(newValues) )"
                    TagMode="@MultiSelectTagMode.Multiple">
                    <MultiSelectSettings>
                        <MultiSelectPopupSettings Height="300px" />
                    </MultiSelectSettings>
                </TelerikMultiSelect>
            </td>
            <td class="HeaderClass HeaderClassCentered">
                <span class="@_spanHeaderClass">Titles:</span>
                <br />
                <TelerikMultiSelect Class="UniformWidth_DropDown"
                                    AutoClose="false"
                                    Enabled="@SessionSelected()"
                                    Data="@_titles?.Select(q => q?.Value).Order()"
                                    Value="@_selectedTitles"
                                    ValueChanged="@((List<string> newValues) => TitlesMultiSelectChanged(newValues))"
                                    TagMode="@MultiSelectTagMode.Multiple">
                    <MultiSelectSettings>
                        <MultiSelectPopupSettings Height="180px" />
                    </MultiSelectSettings>
                </TelerikMultiSelect>
            </td>
            <td class="HeaderClass HeaderClassCentered">
                <span class="@_spanHeaderClass">Reports:</span>
                <br />
                <TelerikMultiSelect
                    Class="UniformWidth_DropDown"
                    AutoClose="false"
                    Enabled="@SessionSelected()"
                    Data="@_reports?.Select(q => q?.Value).Order()"
                    Value="@_selectedReports"
                    ValueChanged="@((List<string> newValues) => ReportsMultiSelectChanged(newValues) )"
                    TagMode="@MultiSelectTagMode.Multiple">
                    <MultiSelectSettings>
                        <MultiSelectPopupSettings Height="300px" />
                    </MultiSelectSettings>
                </TelerikMultiSelect>
            </td>
            <td class="HeaderClass HeaderClassCentered">
                <span class="@_spanHeaderClass">Worklist Groups:</span>
                <br />
                <TelerikMultiSelect
                    Class="UniformWidth_DropDown"
                    AutoClose="false"
                    Enabled="true"
                    Data="@_worklistGroupsBySelectedReports"
                    Value="@_selectedWorklistGroups"
                    ValueChanged="@((List<string> newValues) => WorklistGroupsMultiSelectChanged(newValues) )"
                    TagMode="@MultiSelectTagMode.Multiple">
                    <MultiSelectSettings>
                        <MultiSelectPopupSettings Height="300px" />
                    </MultiSelectSettings>
                </TelerikMultiSelect>
            </td>
        </tr>
        -->
        <tr>
            <td colspan="4" class="@_spanHeaderClass" style="text-align: center;">
                <span style="padding-right: 30px;" class="HeaderClass">Due Date:</span>
                <TelerikDatePicker
                    Min="@_minimumDueDate"
                    Enabled="@SessionSelected()"
                    Width="200px"
                    @bind-Value="@_dueDate" />
            </td>
        </tr>
    </table>

    @if (_allUsers_Display != null && _allUsers_Display.Count() > 0)
    {
        <table width="100%">
            <tr>
                <td style="text-align: right; padding-right: 6px;">
                    <TelerikButton Class="UniformButton" OnClick="@(() => DeSelectAllClicked() )">De-select All</TelerikButton>
                </td>
                <td style="text-align: left; padding-left: 6px;">
                    <TelerikButton Class="UniformButton" OnClick="@(() => SelectAllClicked())">Select All</TelerikButton>
                </td>
            </tr>
        </table>
        <table width="100%">
            <tr>
                <td style="width: 85%; text-align: center;">
                    <!-- DISPLAY GRID -->
                    <TelerikGrid
                        Data="@_allUsers_Display"
                        Pageable="false" ScrollMode="GridScrollMode.Scrollable" Sortable="true" Resizable="true" Reorderable="false"
                        Width="100%" Height="700px"
                        FilterMode="@GridFilterMode.None" Groupable="false"
                        SelectionMode="GridSelectionMode.None"
                        OnRowClick="@OnRowClickHandler_AllUsers">
                        <GridColumns>
                            <!-- https://www.telerik.com/forums/checkbox-column-f1b24f092353 -->
                            <GridColumn Field="@nameof(AllUsers_Display.Selected)" Title="Selected" Width="65px">
                                <!-- https://github.com/telerik/blazor-docs/blob/master/components/grid/templates/column.md -->
                                <Template>
                                    @{
                                        var item = (AllUsers_Display)context;
                                        if (item.Selected == true)
                                        {
                                            <label class="CheckSelected">✔</label>
                                        }
                                        else
                                        {
                                            <span class="CheckSelected">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                                        }
                                    }
                                </Template>
                            </GridColumn>
                            <GridColumn Field="@nameof(AllUsers_Display.UserName)" Title="User Name" Width="300px" />
                            <GridColumn Field="@nameof(AllUsers_Display.EmailAddress)" Title="Email" Width="210px" />
                            <GridColumn Field="@nameof(AllUsers_Display.RoleDesc)" Title="Role" Width="180px" />
                            <GridColumn Field="@nameof(AllUsers_Display.TitleDesc)" Title="Title" Width="180px" />
                        </GridColumns>
                        <GridExport>
                            <GridExcelExport FileName="@Globals.ExportFilename("UserList_Session", _selectedSessionString)"
                                             AllPages="false" />
                        </GridExport>
                    </TelerikGrid>
                    <!-- EXPORT GRID -->
                    <TelerikGrid @ref="@_allUsers_Assignment_ExportGrid"
                                 Data="@_allUsers_Display.Where(q => q?.Selected == true)"
                                 Width="0px" Height="0px">
                        <GridColumns>
                            <GridColumn Field="@nameof(AllUsers_Display.UserName)" Title="User Name" Width="300px" />
                            <GridColumn Field="@nameof(AllUsers_Display.EmailAddress)" Title="Email" Width="210px" />
                            <GridColumn Field="@nameof(AllUsers_Display.RoleDesc)" Title="Role" Width="180px" />
                            <GridColumn Field="@nameof(AllUsers_Display.TitleDesc)" Title="Title" Width="180px" />
                        </GridColumns>
                        <GridExport>
                            <GridExcelExport FileName="@Globals.ExportFilename("UserList_Session", _selectedSessionString)"
                                             AllPages="false" />
                        </GridExport>
                    </TelerikGrid>
                </td>
                <td style="text-align: center; align-items: center; width: 15%;">
                    <TelerikButton Class="UniformButton"
                                   OnClick="@(async() => await Globals.ExportToExcelFile(_allUsers_Assignment_ExportGrid) )"
                                   Enabled="true">
                        EXPORT TO EXCEL
                    </TelerikButton>
                    <br />
                    <TelerikButton
                        Class="UniformButton"
                        OnClick="@(() => SendEmailsToSelectedAndLogToDB_Main() )"
                        Enabled="@_allUsers_Display.Any(q => q?.Selected == true)">
                        SEND EMAILS TO SELECTED
                    </TelerikButton>
                </td>
            </tr>
        </table>
    }
}

<style>
    span.HeaderClass {
        height: 30px;
    }
    td.HeaderClass {
        font-weight: 700;
    }
    .HeaderClassCentered {
        text-align: center;
    }

    .Close {
        background-color: lightgray;
        color: black;
        text-align: center;
    }

    .DisableMe {
        color: darkgrey;
    }

    .UniformButton {
        font-size: small;
        width: 160px;
    }

    .UniformWidth_DropDown {
        width: 260px;
        background-color: white;
    }

    .CheckSelected {
        width: 100%;
        text-align: center;
        font-size: large;
        /*
        color: black;
        border: black 2px solid;
        */
    }
</style>